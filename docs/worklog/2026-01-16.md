# 작업일지 2026-01-16

## 완료 작업

### 1. 데이터 수집 실행
어제 작성한 3개 스크립트 순차 실행:

| 스크립트 | 결과 |
|---------|------|
| `collect_assembly_bills.py` | 의안상세정보 1,021건 |
| `collect_summary.py` | BillInfoService2 20,000건 |
| `merge_bill_data.py` | 병합 완료 (100% 매칭) |

**최종 데이터 품질:**
- committee: 97.3%
- proc_result: **100%**
- summary: **99.6%**
- vote: 85.9%

### 2. Golden Set v2 생성
기존 Golden Set 5개에 summary 추가:

| Golden ID | 법안명 | summary |
|-----------|--------|---------|
| golden_1 | 탄소중립·녹색성장 기본법 | 640자 |
| golden_2 | 중대재해 처벌법 | 424자 |
| golden_3 | 개인정보 보호법 | 389자 |
| golden_4 | 약사법 | 855자 |
| golden_5 | 국유재산특례제한법 | 732자 |

저장: `data/golden_set_v2.json`

### 3. 임베딩 v2 테스트
**제목 vs 제목+Summary** 비교 테스트 실행:

| 모델 | 전체 평균 향상 | Hard 케이스 향상 |
|------|----------------|------------------|
| Solar | +14.4% | 0.387 → 0.479 |
| **OpenAI** | **+29.4%** | 0.378 → 0.491 |

**핵심 발견:**
1. Summary 추가 효과 확실 (평균 14~29% 향상)
2. Hard 케이스에서 효과 극대화 (약사법 +39.9%, 국유재산법 +29.1%)
3. OpenAI가 Summary 활용도 더 높음

### 4. 문서화
Quarto + Markdown 리포트 작성:

```
docs/
├── embedding-v2-report.md      # Markdown 리포트
├── embedding-v2-report.qmd     # Quarto 문서
└── figures/
    ├── similarity_comparison.png
    ├── improvement_comparison.png
    └── difficulty_summary.png
```

## 발견사항

### 임베딩 전략 결론
> **제목+제안이유 임베딩 전략이 Cross-Domain 감지에 효과적**
> - 특히 Hard 케이스(제목만으로 관련성 파악이 어려운 법안)에서 효과 두드러짐
> - OpenAI text-embedding-3-small 권장 (비용 대비 효과 우수)
> - 임계값: v2 기준 0.45 이상이면 관련 법안으로 분류 권장

### API 이슈
- 공공데이터포털 BillInfoService2: 401 Unauthorized (API 키 인증 오류)
- 열린국회정보 의안원문 API: 필수값 누락 오류
- → 기존 수집 데이터(20,000건)에서 Golden Set summary 확보로 해결

## 다음 할 일 (TODO)
1. [ ] 프로덕션 파이프라인에 v2 전략 적용
2. [ ] 전체 1,021건 법안에 대한 산업부 관련성 스코어링
3. [ ] 임계값(0.45) 기반 관련 법안 필터링 테스트
4. [ ] 다른 부처(과기부, 환경부 등) 확장 테스트

## 산출물

```
projects/project-popcorn/
├── data/
│   ├── bills_raw_assembly.json     # 의안상세정보 1,021건
│   ├── bills_raw_summary.json      # BillInfoService2 20,000건
│   ├── bills_merged.json           # 병합 데이터
│   ├── bills_sample_100.json       # 샘플 100건
│   └── golden_set_v2.json          # Golden Set v2
├── research/results/
│   └── embedding_v2_test.json      # 임베딩 테스트 결과
└── docs/
    ├── embedding-v2-report.md
    ├── embedding-v2-report.qmd
    └── figures/*.png
```

---

## 오후 세션 (추가 작업)

### 5. 프로덕션 파이프라인 v2 계획 수립
- `docs/pipeline-v2-plan.md` 작성
- 아키텍처 설계: Ingest → Embed → Score → Alert → Report
- 3 Phase 로드맵 수립

### 6. Phase 1 구현 완료
신규 모듈 3개 구현:

| 모듈 | 역할 | 상태 |
|------|------|------|
| `src/embedder.py` | OpenAI 임베딩, 캐시 지원 | 완료 |
| `src/scorer.py` | 코사인 유사도, Alert Level 결정 | 완료 |
| `src/radar.py` | CrossDomainRadar 클래스 | 완료 |

### 7. Phase 1 통합 테스트
Golden Set 5개로 테스트 실행:

| 결과 | 값 |
|------|-----|
| 감지율 | **60%** (3/5) |
| 임계값 | 0.45 |

**감지된 법안:**
| Alert Level | Score | 법안명 |
|-------------|-------|--------|
| LOW | 0.4960 | 약사법 |
| LOW | 0.4863 | 국유재산특례제한법 |
| LOW | 0.4646 | 중대재해 처벌법 |

**미감지 (0.45 미만):**
- 탄소중립 기본법 (0.4409)
- 개인정보 보호법 (0.3417)

## 다음 할 일 (TODO) - 업데이트
1. [x] ~~데이터 수집 실행~~
2. [x] ~~Golden Set v2 재선정~~
3. [x] ~~임베딩 v2 테스트~~
4. [x] ~~Phase 1 구현~~
5. [ ] Phase 2: pipeline.py, reporter.py 통합
6. [ ] 전체 1,021건 스캔 테스트
7. [ ] 임계값 튜닝 검토 (0.44로 낮추면 탄소중립 기본법도 감지)

## 산출물 (추가)

```
projects/project-popcorn/
├── docs/
│   ├── pipeline-v2-plan.md         # [NEW] 파이프라인 계획
│   ├── embedding-v2-report.md
│   └── figures/*.png
└── src/
    ├── embedder.py                 # [NEW] 임베딩 모듈
    ├── scorer.py                   # [NEW] 스코어링 모듈
    └── radar.py                    # [UPDATE] 레이더 모듈
```

## 비용
- 오늘 API 비용: ~$0.02
  - 임베딩 v2 테스트: Solar 11회, OpenAI 11회
  - Phase 1 테스트: OpenAI ~10회
